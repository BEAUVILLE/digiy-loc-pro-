<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DIGIY LOC PRO ‚Äî M√©dias</title>

  <!-- UI GLOBAL DIGIY -->
  <link rel="stylesheet" href="ui.css" />

  <style>
    .top-nav{
      display:flex; gap:12px;
      padding:12px 16px;
      background:var(--bg, #022c22);
      border-bottom:1px solid rgba(250,204,21,0.2);
    }
    .top-nav a{color:var(--text,#e5e7eb); text-decoration:none; font-weight:700; font-size:.92rem}
    .top-nav a.active{color:var(--accent,#facc15)}

    .medias-page{padding:16px; max-width:560px; margin:auto; color:var(--text,#e5e7eb)}
    .page-header h1{font-size:1.35rem; margin:0 0 6px}
    .page-header p{margin:0; color:var(--muted,#9ca3af); font-size:.95rem}

    .card{
      background:var(--card,#052e16);
      border-radius:14px;
      padding:16px;
      margin-top:16px;
      border:1px solid rgba(250,204,21,0.18);
    }
    .card.highlight{background:linear-gradient(135deg,var(--bg,#022c22),var(--bg2,#065f46))}
    h2{margin:0 0 10px; font-size:1.05rem}
    .hint{margin:0 0 12px; color:#e5e7eb; font-size:.9rem; line-height:1.35}

    .btn{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:none;
      font-weight:800;
      font-size:.95rem;
      cursor:pointer;
    }
    .btn-primary{background:var(--accent,#facc15); color:#022c22}
    .btn-secondary{background:#16a34a; color:#fff}
    .btn-ghost{
      background:transparent;
      border:1px solid rgba(250,204,21,0.35);
      color:var(--text,#e5e7eb);
      margin-top:10px;
    }

    /* Galerie */
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .toolbar .btn{flex:1}
    .gallery{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      margin-top:12px;
    }
    .tile{
      position:relative;
      border-radius:12px;
      overflow:hidden;
      background:var(--bg,#022c22);
      aspect-ratio:1/1;
      border:1px solid rgba(250,204,21,0.14);
    }
    .tile img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .tile .empty{
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      font-size:1.6rem; color:var(--accent,#facc15);
      font-weight:900;
    }
    .badge{
      position:absolute;
      left:8px; top:8px;
      background:rgba(2,44,34,0.75);
      border:1px solid rgba(250,204,21,0.35);
      color:#fff;
      padding:4px 8px;
      border-radius:999px;
      font-size:.72rem;
      font-weight:800;
      backdrop-filter: blur(6px);
    }
    .actions{
      position:absolute;
      right:8px; top:8px;
      display:flex; gap:6px;
    }
    .iconbtn{
      width:34px; height:34px;
      border-radius:10px;
      border:none;
      background:rgba(15,23,42,0.7);
      color:#fff;
      cursor:pointer;
      font-weight:900;
    }
    .iconbtn:hover{filter:brightness(1.1)}
    .tile-footer{
      position:absolute; left:0; right:0; bottom:0;
      display:flex; gap:8px;
      padding:8px;
      background:linear-gradient(180deg, transparent, rgba(0,0,0,.65));
      align-items:center;
      justify-content:space-between;
    }
    .smallbtn{
      border:none; cursor:pointer;
      background:rgba(250,204,21,0.95);
      color:#022c22;
      font-weight:900;
      font-size:.72rem;
      padding:7px 10px;
      border-radius:10px;
    }
    .smallbtn.secondary{
      background:rgba(255,255,255,0.12);
      color:#fff;
      border:1px solid rgba(255,255,255,0.15);
    }

    /* Localisation */
    .benefits{padding-left:18px; margin:10px 0 0}
    .benefits li{margin:6px 0; font-size:.9rem}
    .field{margin-top:10px}
    .field label{display:block; font-weight:800; margin-bottom:6px; font-size:.9rem}
    .field input{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(15,23,42,0.5);
      color:var(--text,#e5e7eb);
      outline:none;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .row .btn{flex:1}
    .map-preview{
      height:160px;
      border-radius:12px;
      background:#0f172a;
      border:1px solid rgba(148,163,184,0.25);
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--muted,#9ca3af);
      margin-top:10px;
      text-align:center;
      padding:10px;
      line-height:1.3;
    }
    .note{
      margin-top:10px;
      color:var(--muted,#9ca3af);
      font-size:.85rem;
      line-height:1.35;
    }

    /* input file hidden */
    #photoInput{display:none}
  </style>
</head>

<body>

  <nav class="top-nav">
    <a href="dashboard.html">üè† Accueil</a>
    <a href="planning.html">üìÖ Planning</a>
    <a href="reservations.html">üßæ R√©servations</a>
    <a href="encaissements.html">üí∞ Encaissements</a>
    <a href="medias.html" class="active">üñºÔ∏è M√©dias</a>
  </nav>

  <main class="medias-page">

    <header class="page-header">
      <h1>üñºÔ∏è M√©dias & Localisation</h1>
      <p>Interface PRO (sans Supabase). Tu ajoutes, tu vois, tu gardes.</p>
    </header>

    <!-- PHOTOS -->
    <section class="card">
      <h2>üì∏ Galerie photos</h2>
      <p class="hint">
        Montre ton lieu, ton s√©rieux. Une bonne galerie = plus de confiance.
      </p>

      <input id="photoInput" type="file" accept="image/*" multiple />

      <div class="toolbar">
        <button class="btn btn-primary" id="btnAdd">‚ûï Ajouter des photos</button>
        <button class="btn btn-ghost" id="btnClear">üßπ Tout effacer</button>
      </div>

      <div class="gallery" id="gallery"></div>

      <p class="note">
        ‚ö†Ô∏è Ici c‚Äôest une d√©mo UI : les photos sont enregistr√©es dans ton navigateur (LocalStorage).
        Quand tu voudras, on branchera un stockage r√©el (mais pas oblig√©).
      </p>
    </section>

    <!-- GOOGLE MAPS -->
    <section class="card highlight">
      <h2>üìç Localisation (recommand√©)</h2>
      <p class="hint">
        Les OTA volent souvent tes coordonn√©es et gardent le client chez eux.
        Google Maps te rend ton adresse, ton t√©l√©phone, et le GPS jusqu‚Äô√† ton business.
      </p>

      <ul class="benefits">
        <li>‚úÖ Galerie photos illimit√©e sur Google</li>
        <li>‚úÖ Appels directs des clients</li>
        <li>‚úÖ Itin√©raire GPS imm√©diat</li>
      </ul>

      <div class="field">
        <label for="addr">Ton adresse (ex: ‚ÄúChez Baptiste Saly‚Äù, rue/quartier)</label>
        <input id="addr" type="text" placeholder="Nom + quartier + ville (ex: Boutique Astou, Saly Centre)" />
      </div>

      <div class="row">
        <button class="btn btn-secondary" id="btnMaps">üìç Ouvrir dans Google Maps</button>
        <button class="btn btn-ghost" id="btnSaveLoc">üíæ Sauver</button>
      </div>

      <div class="map-preview" id="mapPreview">
        Mets une adresse ci-dessus puis clique ‚ÄúOuvrir dans Google Maps‚Äù.
      </div>

      <p class="note">
        Astuce : sur Google Maps, le pro peut cr√©er / revendiquer sa fiche et reprendre ses infos.
      </p>
    </section>

  </main>

  <script>
    // ====== LocalStorage helpers ======
    const LS_KEY = "digiy_loc_pro_medias_v1";
    const LS_LOC = "digiy_loc_pro_location_v1";

    function loadState(){
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || { photos: [], coverIndex: 0 }; }
      catch(e){ return { photos: [], coverIndex: 0 }; }
    }

    function saveState(state){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }

    function loadLoc(){
      return localStorage.getItem(LS_LOC) || "";
    }

    function saveLoc(v){
      localStorage.setItem(LS_LOC, v || "");
    }

    // ====== UI Elements ======
    const galleryEl = document.getElementById("gallery");
    const photoInput = document.getElementById("photoInput");
    const btnAdd = document.getElementById("btnAdd");
    const btnClear = document.getElementById("btnClear");

    const addrEl = document.getElementById("addr");
    const btnMaps = document.getElementById("btnMaps");
    const btnSaveLoc = document.getElementById("btnSaveLoc");
    const mapPreview = document.getElementById("mapPreview");

    let state = loadState();

    // ====== Render gallery ======
    function render(){
      galleryEl.innerHTML = "";

      if(!state.photos.length){
        for(let i=0;i<3;i++){
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.innerHTML = `<div class="empty">+</div>`;
          tile.addEventListener("click", () => photoInput.click());
          galleryEl.appendChild(tile);
        }
        return;
      }

      state.photos.forEach((src, idx) => {
        const tile = document.createElement("div");
        tile.className = "tile";

        const isCover = idx === (state.coverIndex ?? 0);

        tile.innerHTML = `
          ${isCover ? `<div class="badge">Photo principale</div>` : ``}
          <div class="actions">
            <button class="iconbtn" title="Supprimer" data-del="${idx}">‚úï</button>
          </div>
          <img src="${src}" alt="Photo ${idx+1}">
          <div class="tile-footer">
            <button class="smallbtn" data-cover="${idx}">‚òÖ Principal</button>
            <button class="smallbtn secondary" data-moveleft="${idx}">‚Üê</button>
            <button class="smallbtn secondary" data-moveright="${idx}">‚Üí</button>
          </div>
        `;

        galleryEl.appendChild(tile);
      });

      // bind actions
      galleryEl.querySelectorAll("[data-del]").forEach(b=>{
        b.addEventListener("click", (e)=>{
          e.stopPropagation();
          const i = Number(b.getAttribute("data-del"));
          state.photos.splice(i,1);
          if(state.coverIndex >= state.photos.length) state.coverIndex = 0;
          saveState(state); render();
        });
      });

      galleryEl.querySelectorAll("[data-cover]").forEach(b=>{
        b.addEventListener("click",(e)=>{
          e.stopPropagation();
          state.coverIndex = Number(b.getAttribute("data-cover"));
          saveState(state); render();
        });
      });

      galleryEl.querySelectorAll("[data-moveleft]").forEach(b=>{
        b.addEventListener("click",(e)=>{
          e.stopPropagation();
          const i = Number(b.getAttribute("data-moveleft"));
          if(i<=0) return;
          const tmp = state.photos[i-1];
          state.photos[i-1] = state.photos[i];
          state.photos[i] = tmp;

          // adjust cover index
          if(state.coverIndex === i) state.coverIndex = i-1;
          else if(state.coverIndex === i-1) state.coverIndex = i;

          saveState(state); render();
        });
      });

      galleryEl.querySelectorAll("[data-moveright]").forEach(b=>{
        b.addEventListener("click",(e)=>{
          e.stopPropagation();
          const i = Number(b.getAttribute("data-moveright"));
          if(i>=state.photos.length-1) return;
          const tmp = state.photos[i+1];
          state.photos[i+1] = state.photos[i];
          state.photos[i] = tmp;

          if(state.coverIndex === i) state.coverIndex = i+1;
          else if(state.coverIndex === i+1) state.coverIndex = i;

          saveState(state); render();
        });
      });
    }

    // ====== Add photos (preview only) ======
    btnAdd.addEventListener("click", () => photoInput.click());

    photoInput.addEventListener("change", async (e) => {
      const files = Array.from(e.target.files || []);
      if(!files.length) return;

      // Convert to base64 for UI demo (local only)
      for(const file of files){
        const dataUrl = await fileToDataURL(file);
        state.photos.push(dataUrl);
      }

      if(state.photos.length && (state.coverIndex == null)) state.coverIndex = 0;

      saveState(state);
      render();
      photoInput.value = "";
    });

    btnClear.addEventListener("click", () => {
      if(!confirm("Tout effacer (local) ?")) return;
      state = { photos: [], coverIndex: 0 };
      saveState(state);
      render();
    });

    function fileToDataURL(file){
      return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // ====== Google Maps (no API) ======
    function mapsUrlFromAddress(addr){
      const q = encodeURIComponent(addr.trim());
      return `https://www.google.com/maps/search/?api=1&query=${q}`;
    }

    function refreshPreview(){
      const addr = addrEl.value.trim();
      if(!addr){
        mapPreview.textContent = "Mets une adresse ci-dessus puis clique ‚ÄúOuvrir dans Google Maps‚Äù.";
        return;
      }
      mapPreview.innerHTML = `
        <div>
          <div style="font-weight:900;color:#e5e7eb;margin-bottom:6px">Aper√ßu</div>
          <div style="color:#9ca3af;margin-bottom:10px">${escapeHtml(addr)}</div>
          <div style="font-size:.9rem;color:#9ca3af">Le bouton ouvrira Google Maps avec itin√©raire.</div>
        </div>
      `;
    }

    btnMaps.addEventListener("click", () => {
      const addr = addrEl.value.trim();
      if(!addr){
        alert("Mets une adresse d‚Äôabord.");
        return;
      }
      window.open(mapsUrlFromAddress(addr), "_blank");
    });

    btnSaveLoc.addEventListener("click", () => {
      saveLoc(addrEl.value.trim());
      alert("Localisation sauvegard√©e (local).");
    });

    addrEl.addEventListener("input", refreshPreview);

    function escapeHtml(str){
      return str.replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    // ====== Init ======
    addrEl.value = loadLoc();
    refreshPreview();
    render();
  </script>

</body>
</html>
