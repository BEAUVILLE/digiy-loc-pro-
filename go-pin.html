<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>DIGIY ‚Äî GO PIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* =========================
   DESIGN SIMPLE & PRO (terrain)
========================= */
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#020617;
  color:#f9fafb;
}
.app{
  max-width:900px;
  margin:0 auto;
  padding:14px;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.brand{
  font-weight:900;
  font-size:18px;
}
.brand span{color:#facc15}
.tag{
  font-size:12px;
  color:#9ca3af;
}

.hero{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}
.hero h1{
  margin:0 0 6px;
  font-size:22px;
}
.hero p{
  margin:0 0 10px;
  font-size:14px;
  color:#cbd5f5;
}
.hero img{
  width:100%;
  max-height:240px;
  object-fit:cover;
  border-radius:14px;
  border:1px solid #1f2937;
}

.price-block{
  margin-top:12px;
  padding:12px;
  border-radius:14px;
  border:1px solid #1f2937;
}
.price-block h2{
  margin:0 0 6px;
  font-size:16px;
  color:#facc15;
}
.tarifs span{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:4px;
}

.wave{
  margin-top:12px;
  padding:14px;
  border-radius:16px;
  border:2px solid #22c55e;
  background:#022c22;
}
.wave .num{
  font-size:24px;
  font-weight:900;
  color:#22c55e;
}

.cta{
  display:flex;
  gap:10px;
  margin-top:14px;
  flex-wrap:wrap;
}
.btn{
  flex:1;
  padding:12px;
  border-radius:999px;
  border:none;
  font-size:15px;
  font-weight:800;
  cursor:pointer;
}
.btn-wa{background:#22c55e;color:#022c22}
.btn-call{background:#111827;color:#e5e7eb;border:1px solid #1f2937}

footer{
  margin-top:18px;
  text-align:center;
  font-size:12px;
  color:#9ca3af;
}
</style>
</head>

<body>
<div class="app">

<header>
  <div class="brand" id="brandTitle">DIGIY LOC</div>
  <div class="tag" id="tagLine">‚Äî</div>
</header>

<section class="hero">
  <h1 id="heroTitle">‚Äî</h1>
  <p id="heroDesc">‚Äî</p>

  <img id="heroPhoto" src="" alt="Photo du logement">

  <div class="price-block">
    <h2>Tarifs</h2>
    <div class="tarifs">
      <span><span>Nuit :</span><strong id="priceNight">‚Äî</strong></span>
      <span><span>Semaine :</span><strong id="priceWeek">‚Äî</strong></span>
      <span><span>Mois :</span><strong id="priceMonth">‚Äî</strong></span>
    </div>
  </div>

  <div class="wave">
    üí≥ Paiement direct propri√©taire ‚Äî Wave
    <div class="num" id="wavePhone">‚Äî</div>
    <div style="margin-top:6px">
      Propri√©taire : <strong id="ownerName">‚Äî</strong>
    </div>
  </div>

  <div class="cta">
    <button class="btn btn-wa" id="btnWa">üí¨ R√©server par WhatsApp</button>
    <button class="btn btn-call" id="btnCall">üìû Appeler le propri√©taire</button>
  </div>
</section>

<footer id="footerTxt">DIGIY LOC ‚ôæÔ∏è</footer>

</div>

<!-- =========================
     SUPABASE + LOGIQUE
========================= -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* üîê SUPABASE ‚Äî D√âJ√Ä POS√â */
const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

// -------- helpers ----------
const pick = (o, keys, d="‚Äî") => {
  for (const k of keys) {
    if (o && o[k] !== null && o[k] !== undefined && o[k] !== "") return o[k];
  }
  return d;
};
const money = (v) => {
  const n = Number(v);
  return Number.isFinite(n) && n > 0 ? n.toLocaleString("fr-FR")+" F" : "‚Äî";
};

// -------- slug ----------
const slug = new URLSearchParams(window.location.search).get("slug");
if (!slug) {
  alert("Slug manquant");
  throw new Error("Slug manquant");
}

// -------- load ----------
(async () => {
  const { data, error } = await supabase
    .from("go_pins")
    .select("*")
    .eq("slug", slug)
    .single();

  console.log("GO_PIN DATA =", data);
  if (error || !data) {
    alert("Lieu introuvable");
    console.error(error);
    return;
  }

  // -------- mapping TOL√âRANT ----------
  const title        = pick(data, ["title","name","label"]);
  const city         = pick(data, ["city","ville","location"]);
  const desc         = pick(data, ["description","desc","about"], "");
  const maxGuests    = pick(data, ["max_guests","guests","capacity"], "");
  const photo        = pick(data, ["photo_url","cover_url","image_url","photo"]);
  const priceNight   = pick(data, ["price_night","night_price","price"]);
  const priceWeek    = pick(data, ["price_week","week_price"]);
  const priceMonth   = pick(data, ["price_month","month_price"]);
  const ownerName    = pick(data, ["owner_name","proprietaire","owner"]);
  const ownerPhone   = pick(data, ["owner_phone","phone","telephone"]);
  const ownerWa      = pick(data, ["owner_whatsapp","whatsapp","wa"]);
  const wavePhone    = pick(data, ["wave_phone","wave","payment_wave", "owner_phone","phone"]);

  // -------- injection ----------
  document.title = title + " ‚Äî DIGIY LOC";
  document.getElementById("brandTitle").textContent = title || "DIGIY LOC";
  document.getElementById("heroTitle").textContent =
    title + (city !== "‚Äî" ? " ‚Äî " + city : "");
  document.getElementById("heroDesc").textContent = desc || "";
  document.getElementById("tagLine").textContent =
    [city, maxGuests ? maxGuests+" pers max" : ""].filter(Boolean).join(" ¬∑ ");

  const img = document.getElementById("heroPhoto");
  if (photo && photo !== "‚Äî") {
    img.src = photo;
    img.style.display = "block";
  } else {
    img.style.display = "none";
  }

  document.getElementById("priceNight").textContent = money(priceNight);
  document.getElementById("priceWeek").textContent  = money(priceWeek);
  document.getElementById("priceMonth").textContent = money(priceMonth);

  document.getElementById("wavePhone").textContent = wavePhone;
  document.getElementById("ownerName").textContent = ownerName;

  document.getElementById("btnCall").onclick = () => {
    if (ownerPhone && ownerPhone !== "‚Äî") {
      window.location.href = "tel:" + ownerPhone;
    }
  };

  document.getElementById("btnWa").onclick = () => {
    if (!ownerWa || ownerWa === "‚Äî") return;
    const msg = `Bonjour, je souhaite r√©server ${title}${city ? " √† "+city : ""}.`;
    window.open(
      "https://wa.me/" + ownerWa.replace(/\D/g,"") +
      "?text=" + encodeURIComponent(msg),
      "_blank"
    );
  };

  document.getElementById("footerTxt").textContent =
    `${title} ¬∑ DIGIY LOC ¬∑ ${ownerPhone || ""}`;
})();
</script>
</body>
</html>
