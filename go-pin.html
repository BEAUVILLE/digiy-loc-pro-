<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>DIGIY ‚Äî GO PIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* =========================
   DESIGN SIMPLE & PRO (terrain)
========================= */
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#020617;
  color:#f9fafb;
}
.app{
  max-width:900px;
  margin:0 auto;
  padding:14px;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.brand{
  font-weight:900;
  font-size:18px;
}
.brand span{color:#facc15}
.tag{
  font-size:12px;
  color:#9ca3af;
}

.hero{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}
.hero h1{
  margin:0 0 6px;
  font-size:22px;
}
.hero p{
  margin:0 0 10px;
  font-size:14px;
  color:#cbd5f5;
}
.hero img{
  width:100%;
  max-height:240px;
  object-fit:cover;
  border-radius:14px;
  border:1px solid #1f2937;
}

.price-block{
  margin-top:12px;
  padding:12px;
  border-radius:14px;
  border:1px solid #1f2937;
}
.price-block h2{
  margin:0 0 6px;
  font-size:16px;
  color:#facc15;
}
.tarifs span{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:4px;
}

.wave{
  margin-top:12px;
  padding:14px;
  border-radius:16px;
  border:2px solid #22c55e;
  background:#022c22;
}
.wave .num{
  font-size:24px;
  font-weight:900;
  color:#22c55e;
}

.cta{
  display:flex;
  gap:10px;
  margin-top:14px;
  flex-wrap:wrap;
}
.btn{
  flex:1;
  padding:12px;
  border-radius:999px;
  border:none;
  font-size:15px;
  font-weight:800;
  cursor:pointer;
}
.btn-wa{background:#22c55e;color:#022c22}
.btn-call{background:#111827;color:#e5e7eb;border:1px solid #1f2937}

footer{
  margin-top:18px;
  text-align:center;
  font-size:12px;
  color:#9ca3af;
}
</style>
</head>

<body>
<div class="app">

<header>
  <div class="brand" id="brandTitle">DIGIY LOC</div>
  <div class="tag" id="tagLine">‚Äî</div>
</header>

<section class="hero">
  <h1 id="heroTitle">‚Äî</h1>
  <p id="heroDesc">‚Äî</p>

  <img id="heroPhoto" src="" alt="Photo du logement">

  <div class="price-block">
    <h2>Tarifs</h2>
    <div class="tarifs">
      <span><span>Nuit :</span><strong id="priceNight">‚Äî</strong></span>
      <span><span>Semaine :</span><strong id="priceWeek">‚Äî</strong></span>
      <span><span>Mois :</span><strong id="priceMonth">‚Äî</strong></span>
    </div>
  </div>

  <div class="wave">
    üí≥ Paiement direct propri√©taire ‚Äî Wave
    <div class="num" id="wavePhone">‚Äî</div>
    <div style="margin-top:6px">
      Propri√©taire : <strong id="ownerName">‚Äî</strong>
    </div>
  </div>

  <div class="cta">
    <button class="btn btn-wa" id="btnWa">üí¨ R√©server par WhatsApp</button>
    <button class="btn btn-call" id="btnCall">üìû Appeler le propri√©taire</button>
  </div>
</section>

<footer id="footerTxt">DIGIY LOC ‚ôæÔ∏è</footer>

</div>

<!-- =========================
     SUPABASE + LOGIQUE
========================= -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* üîê SUPABASE ‚Äî D√âJ√Ä POS√â */
const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

// slug
const slug = new URLSearchParams(window.location.search).get("slug");
if (!slug) {
  alert("Slug manquant");
  throw new Error("Slug manquant");
}

(async () => {
  const { data, error } = await supabase
    .from("go_pins")
    .select("*")
    .eq("slug", slug)
    .single();

  if (error || !data) {
    alert("Lieu introuvable");
    console.error(error);
    return;
  }

  // Injection
  document.title = data.title + " ‚Äî DIGIY LOC";
  document.getElementById("brandTitle").textContent = data.title;
  document.getElementById("heroTitle").textContent =
    data.title + " ‚Äî " + data.city;
  document.getElementById("heroDesc").textContent = data.description;
  document.getElementById("tagLine").textContent =
    data.city + " ¬∑ " + data.max_guests + " pers max";

  document.getElementById("heroPhoto").src = data.photo_url;

  document.getElementById("priceNight").textContent =
    data.price_night.toLocaleString("fr-FR") + " F";
  document.getElementById("priceWeek").textContent =
    data.price_week.toLocaleString("fr-FR") + " F";
  document.getElementById("priceMonth").textContent =
    data.price_month.toLocaleString("fr-FR") + " F";

  document.getElementById("wavePhone").textContent = data.wave_phone;
  document.getElementById("ownerName").textContent = data.owner_name;

  document.getElementById("btnCall").onclick = () => {
    window.location.href = "tel:" + data.owner_phone;
  };

  document.getElementById("btnWa").onclick = () => {
    const msg =
      "Bonjour, je souhaite r√©server " +
      data.title + " √† " + data.city + ".";
    window.open(
      "https://wa.me/" + data.owner_whatsapp +
      "?text=" + encodeURIComponent(msg),
      "_blank"
    );
  };

  document.getElementById("footerTxt").textContent =
    data.title + " ¬∑ DIGIY LOC ¬∑ WhatsApp " + data.owner_phone;
})();
</script>
</body>
</html>
